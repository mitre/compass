<div id="compassPage" x-data="alpineCompass()">
    <div>
        <div>
            <h2>Compass<sub class="is-size-7 pl-1">find your way</sub></h2>
        </div>
        <p>Generate a layer file for any adversary, which you can overlay on the matrix below
            <b>OR</b> Create an adversary in the matrix, then
            upload the layer file to generate an adversary to use in an operation</p>
    </div>
    <hr>
    <div>
        <div class="is-flex is-flex-direction-row mb-4">
            <div class="is-flex is-flex-direction-column">
                <label for="layer-selection-adversary" class="pb-2 is-size-6">Generate Layer</label>
                <div class="is-flex is-flex-direction-row is-align-items-center">
                    <div id="layerSelectionAdversary" class="mt-1 mr-2">
                        <select id="layer-selection-adversary">
                            <option value="" selected>Select an Adversary (All)</option>
                            {% for adv in adversaries %}
                            <option value="{{ adv.adversary_id }}">{{ adv.name }}</option>
                            {% endfor %}}
                        </select>
                    </div>
                    <label for="generateLayer">
                        <button id="generateLayer" class="button is-primary is-small"
                                onclick="generateLayer()"><i class="pr-1 fas fa-download"></i>
                            <span class="has-tooltip-multiline has-tooltip-bottom"
                                  data-tooltip="Click 'Generate Layer'. Click '+' to open a new tab in the navigator. Select 'Open Existing Layer'. Select 'Upload from local' and upload the generated layer file.">Generate Layer
                            </span>
                        </button>
                    </label>
                </div>
            </div>
            <div class="is-flex is-flex-direction-column ml-6">
                <label for="generateAdversary" class="pb-2 is-size-6">Generate Adversary</label>
                <div class="is-flex is-flex-direction-row">
                    <label for="generateAdversary">
                        <button id="generateAdversary" class="button is-primary is-small"
                                onclick="uploadAdversaryLayerButtonFileUpload()"><i class="pr-1 fas fa-upload"></i>
                            <span class="has-tooltip-multiline has-tooltip-bottom"
                                  data-tooltip="Create an adversary by selecting techniques in the ATT&CK matrix below, or right click to 'add to selection'. Then download the layer as json (in the toolbar) and upload the Adversary layer file here. You can now use the Adversary profile in CALDERA, under the name given the layer file.">
                                Create Operation
                            </span>
                        </button>
                    </label>
                    <input id='adversaryLayerInput' type='file' hidden/>
                </div>
            </div>
        </div>
    </div>
    <div>
        <iframe src="https://mitre-attack.github.io/attack-navigator/enterprise/" class="frame">
        </iframe>
    </div>
</div>


<template x-if="openModal">
    <div class="modal is-active">
        <div class="modal-background" @click="openModal = false"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Adversary Created</p>
                <h3 x-text="adversaryCreated.name"></h3>
                <h3 x-text="adversaryCreated.response"></h3>
            </header>
            <section class="modal-card-body">
                <div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th id="missing-abilities-tactic">Tactic</th>
                            <th id="missing-abilities-technique">Technique ID</th>
                        </tr>
                        </thead>
                        <tbody id="missing-abilities-body">
                        </tbody>
                    </table>
                    <p class="has-text-centered">An adversary is only as good as its abilities. APT layers will
                        cover the same tactics and techniques. Procedures that accurately represent an APT only
                        come from proper curation of an adversary.</p>
                </div>
            </section>
            <footer class="modal-card-foot">
                <nav class="level">
                    <div class="level-left">
                    </div>
                    <div class="level-right">
                        <div class="level-item">
                            <button class="button is-small" @click="openModal = false">Close</button>
                        </div>
                    </div>
                </nav>
            </footer>
        </div>
    </div>
</template>

<script>
    function alpineOperations() {
        return {
            openModal: true,
            adversaryCreated: {
                name: '',
                response: ''
            }
        };
    }
</script>
<style>
    #compassPage .frame {
        display: flex;
        width: 100%;
        border-radius: 5px;
        overflow: auto;
        height: 900px;
        border: 2px solid #666666;
    }
</style>
